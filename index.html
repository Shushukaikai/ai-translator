<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>快快记录</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-900 p-6 font-sans">
  <h1 class="text-3xl font-bold text-blue-700 mb-4">🎤 快快记录</h1>
  <button id="recordBtn" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">🎙️ 开始录音</button>

  <div class="mt-6">
    <p class="text-gray-700"><strong>识别内容：</strong></p>
    <div id="speechText" class="text-blue-800 whitespace-pre-line mt-2 border p-4 rounded bg-gray-100"></div>
  </div>

  <script>
    const recordBtn = document.getElementById("recordBtn");
    const speechText = document.getElementById("speechText");
    const DEEPSEEK_API_KEY = "sk-56a600d343c9459aa330650d85891179";  // 你的 API Key

    let mediaRecorder;
    let chunks = [];

    async function startRecording() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      chunks = [];

      mediaRecorder.ondataavailable = e => chunks.push(e.data);
      mediaRecorder.onstop = async () => {
        const blob = new Blob(chunks, { type: "audio/webm" });
        const base64Audio = await blobToBase64(blob);

        speechText.innerText += "\n⏳ 正在识别...\n";

        try {
          const whisperRes = await fetch("https://api.deepseek.com/v1/audio/transcriptions", {
            method: "POST",
            headers: {
              "Authorization": `Bearer ${DEEPSEEK_API_KEY}`,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              model: "whisper-1",
              audio: base64Audio
            })
          });

          const data = await whisperRes.json();
          const text = data.text || "⚠️ 无识别结果";
          speechText.innerText += `✅ ${text}\n`;
        } catch (err) {
          console.error(err);
          speechText.innerText += "⚠️ 识别失败\n";
        }
      };

      mediaRecorder.start();
      recordBtn.innerText = "🎙 正在录音（3秒）";
      setTimeout(() => {
        mediaRecorder.stop();
        recordBtn.innerText = "🎙️ 开始录音";
      }, 3000);
    }

    function blobToBase64(blob) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result.split(',')[1]);
        reader.onerror = reject;
        reader.readAsDataURL(blob);
      });
    }

    recordBtn.onclick = () => {
      startRecording();
    };
  </script>
</body>
</html>
