<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>🎤 AI语音翻译助手</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 p-6">
  <h1 class="text-2xl font-bold mb-4">🎤 AI语音翻译助手</h1>
  <button id="recordBtn" class="bg-blue-600 text-white px-4 py-2 rounded">🎙 开始说话</button>
  <p class="mt-4"><strong>识别内容：</strong> <span id="speechText" class="text-blue-800"></span></p>
  <p class="mt-2"><strong>翻译结果：</strong> <span id="translatedText" class="text-green-800 font-bold"></span></p>

  <script>
    const recordBtn = document.getElementById("recordBtn");
    const speechText = document.getElementById("speechText");
    const translatedText = document.getElementById("translatedText");

    let mediaRecorder;
    let chunks = [];

    async function startRecording() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      chunks = [];

      mediaRecorder.ondataavailable = e => chunks.push(e.data);
      mediaRecorder.onstop = async () => {
        const blob = new Blob(chunks, { type: "audio/webm" });
        const formData = new FormData();
        formData.append("audio", blob);

        translatedText.innerText = "识别中...";
        speechText.innerText = "";

        try {
          const res = await fetch("https://ai-translator-proxy.vercel.app/api/whisper_baidu", {
            method: "POST",
            body: formData
          });
          const data = await res.json();

          if (data.error) {
            translatedText.innerText = "⚠️ 出错：" + data.error;
          } else {
            speechText.innerText = data.recognizedText;
            translatedText.innerText = data.translatedText;
          }
        } catch (err) {
          translatedText.innerText = "⚠️ 请求失败";
        }
      };

      mediaRecorder.start();
      recordBtn.innerText = "🎙 正在录音（3秒）";

      setTimeout(() => {
        mediaRecorder.stop();
        recordBtn.innerText = "🎙 开始说话";
      }, 3000);
    }

    recordBtn.onclick = () => {
      startRecording();
    };
  </script>
</body>
</html>
